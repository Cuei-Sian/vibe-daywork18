<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <svg viewBox="0 0 1200 1400" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- 定義箭頭 -->
        <marker
          id="arrowblue"
          markerWidth="10"
          markerHeight="10"
          refX="9"
          refY="3"
          orient="auto"
          markerUnits="strokeWidth"
        >
          <path d="M0,0 L0,6 L9,3 z" fill="#4a90e2" />
        </marker>
        <marker
          id="arrowgreen"
          markerWidth="10"
          markerHeight="10"
          refX="9"
          refY="3"
          orient="auto"
          markerUnits="strokeWidth"
        >
          <path d="M0,0 L0,6 L9,3 z" fill="#52c41a" />
        </marker>
        <marker
          id="arroworange"
          markerWidth="10"
          markerHeight="10"
          refX="9"
          refY="3"
          orient="auto"
          markerUnits="strokeWidth"
        >
          <path d="M0,0 L0,6 L9,3 z" fill="#fa8c16" />
        </marker>
        <marker
          id="arrowpurple"
          markerWidth="10"
          markerHeight="10"
          refX="9"
          refY="3"
          orient="auto"
          markerUnits="strokeWidth"
        >
          <path d="M0,0 L0,6 L9,3 z" fill="#9254de" />
        </marker>

        <!-- 流動動畫 - 資料流 -->
        <style>
          @keyframes flowBlue {
            0% {
              stroke-dashoffset: 20;
            }
            100% {
              stroke-dashoffset: 0;
            }
          }
          @keyframes flowGreen {
            0% {
              stroke-dashoffset: 20;
            }
            100% {
              stroke-dashoffset: 0;
            }
          }
          @keyframes flowOrange {
            0% {
              stroke-dashoffset: 20;
            }
            100% {
              stroke-dashoffset: 0;
            }
          }
          @keyframes flowPurple {
            0% {
              stroke-dashoffset: 20;
            }
            100% {
              stroke-dashoffset: 0;
            }
          }
          .flow-blue {
            stroke-dasharray: 10 5;
            animation: flowBlue 1s linear infinite;
          }
          .flow-green {
            stroke-dasharray: 10 5;
            animation: flowGreen 1s linear infinite;
          }
          .flow-orange {
            stroke-dasharray: 10 5;
            animation: flowOrange 1s linear infinite;
          }
          .flow-purple {
            stroke-dasharray: 10 5;
            animation: flowPurple 1s linear infinite;
          }
        </style>
      </defs>

      <!-- 標題 -->
      <text
        x="600"
        y="35"
        font-size="24"
        font-weight="bold"
        text-anchor="middle"
        fill="#333"
      >
        Future 3C Store - 架構流程圖
      </text>
      <text x="600" y="60" font-size="14" text-anchor="middle" fill="#666">
        資料流向 · 函式呼叫 · DOM 操作 · 事件綁定
      </text>

      <!-- 圖例 -->
      <g transform="translate(50, 80)">
        <text x="0" y="0" font-size="12" font-weight="bold" fill="#333">
          圖例：
        </text>
        <line
          x1="0"
          y1="15"
          x2="40"
          y2="15"
          stroke="#4a90e2"
          stroke-width="2"
          marker-end="url(#arrowblue)"
          class="flow-blue"
        />
        <text x="45" y="20" font-size="11" fill="#666">資料流</text>

        <line
          x1="100"
          y1="15"
          x2="140"
          y2="15"
          stroke="#52c41a"
          stroke-width="2"
          marker-end="url(#arrowgreen)"
          class="flow-green"
        />
        <text x="145" y="20" font-size="11" fill="#666">函式呼叫</text>

        <line
          x1="220"
          y1="15"
          x2="260"
          y2="15"
          stroke="#fa8c16"
          stroke-width="2"
          marker-end="url(#arroworange)"
          class="flow-orange"
        />
        <text x="265" y="20" font-size="11" fill="#666">DOM 操作</text>

        <line
          x1="340"
          y1="15"
          x2="380"
          y2="15"
          stroke="#9254de"
          stroke-width="2"
          marker-end="url(#arrowpurple)"
          class="flow-purple"
        />
        <text x="385" y="20" font-size="11" fill="#666">事件綁定</text>
      </g>

      <!-- 第一層：外部 API -->
      <rect
        x="450"
        y="130"
        width="300"
        height="80"
        rx="8"
        fill="#fff4e6"
        stroke="#fa8c16"
        stroke-width="2"
      />
      <text
        x="600"
        y="155"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#d46b08"
      >
        外部 API
      </text>
      <text x="600" y="175" font-size="12" text-anchor="middle" fill="#ad6800">
        Google Sheets CSV
      </text>
      <text x="600" y="195" font-size="10" text-anchor="middle" fill="#999">
        CSV_URL
      </text>

      <!-- 第二層：PapaParse 函式庫 -->
      <rect
        x="450"
        y="260"
        width="300"
        height="70"
        rx="8"
        fill="#e6f7ff"
        stroke="#1890ff"
        stroke-width="2"
      />
      <text
        x="600"
        y="285"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#0050b3"
      >
        PapaParse 函式庫
      </text>
      <text x="600" y="305" font-size="11" text-anchor="middle" fill="#096dd9">
        Papa.parse()
      </text>

      <!-- 連接線：API → PapaParse (流動) -->
      <line
        x1="600"
        y1="210"
        x2="600"
        y2="260"
        stroke="#4a90e2"
        stroke-width="2.5"
        marker-end="url(#arrowblue)"
        class="flow-blue"
      />
      <text x="620" y="240" font-size="10" fill="#4a90e2">下載 CSV</text>

      <!-- 第三層：初始化函式 -->
      <rect
        x="480"
        y="380"
        width="240"
        height="90"
        rx="8"
        fill="#f6ffed"
        stroke="#52c41a"
        stroke-width="2"
      />
      <text
        x="600"
        y="405"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#237804"
      >
        init()
      </text>
      <text x="600" y="425" font-size="10" text-anchor="middle" fill="#52c41a">
        • 檢查 CSV_URL
      </text>
      <text x="600" y="443" font-size="10" text-anchor="middle" fill="#52c41a">
        • 呼叫 Papa.parse()
      </text>
      <text x="600" y="461" font-size="10" text-anchor="middle" fill="#52c41a">
        • 處理成功/失敗回調
      </text>

      <!-- 連接線：PapaParse → init (流動) -->
      <line
        x1="600"
        y1="330"
        x2="600"
        y2="380"
        stroke="#52c41a"
        stroke-width="2.5"
        marker-end="url(#arrowgreen)"
        class="flow-green"
      />

      <!-- 第四層A：成功回調 -->
      <rect
        x="150"
        y="520"
        width="200"
        height="110"
        rx="8"
        fill="#f0f5ff"
        stroke="#597ef7"
        stroke-width="2"
      />
      <text
        x="250"
        y="545"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#1d39c4"
      >
        complete 回調
      </text>
      <text x="250" y="565" font-size="10" text-anchor="middle" fill="#597ef7">
        results.data 接收
      </text>
      <text x="250" y="583" font-size="10" text-anchor="middle" fill="#597ef7">
        ↓
      </text>
      <text x="250" y="600" font-size="10" text-anchor="middle" fill="#597ef7">
        allData = results.data
      </text>
      <text x="250" y="618" font-size="10" text-anchor="middle" fill="#597ef7">
        儲存至全域變數
      </text>

      <!-- 第四層B：錯誤回調 -->
      <rect
        x="850"
        y="520"
        width="200"
        height="110"
        rx="8"
        fill="#fff1f0"
        stroke="#ff4d4f"
        stroke-width="2"
      />
      <text
        x="950"
        y="545"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#cf1322"
      >
        error 回調
      </text>
      <text x="950" y="565" font-size="10" text-anchor="middle" fill="#ff4d4f">
        錯誤處理
      </text>
      <text x="950" y="583" font-size="10" text-anchor="middle" fill="#ff4d4f">
        ↓
      </text>
      <text x="950" y="600" font-size="10" text-anchor="middle" fill="#ff4d4f">
        app.innerHTML
      </text>
      <text x="950" y="618" font-size="10" text-anchor="middle" fill="#ff4d4f">
        顯示錯誤訊息
      </text>

      <!-- 連接線：init → 成功/失敗 (繞過卡片，流動) -->
      <path
        d="M 500 470 L 420 495 L 250 495 L 250 520"
        fill="none"
        stroke="#4a90e2"
        stroke-width="2.5"
        marker-end="url(#arrowblue)"
        class="flow-blue"
      />
      <text x="340" y="485" font-size="10" fill="#4a90e2">成功</text>

      <path
        d="M 700 470 L 780 495 L 950 495 L 950 520"
        fill="none"
        stroke="#ff4d4f"
        stroke-width="2.5"
        marker-end="url(#arrowblue)"
        class="flow-blue"
      />
      <text x="820" y="485" font-size="10" fill="#ff4d4f">失敗</text>

      <!-- 第五層：renderCards 函式 -->
      <rect
        x="130"
        y="680"
        width="240"
        height="110"
        rx="8"
        fill="#fff7e6"
        stroke="#fa8c16"
        stroke-width="2"
      />
      <text
        x="250"
        y="705"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#d46b08"
      >
        renderCards(data)
      </text>
      <text x="250" y="725" font-size="10" text-anchor="middle" fill="#fa8c16">
        • 清空 app.innerHTML
      </text>
      <text x="250" y="743" font-size="10" text-anchor="middle" fill="#fa8c16">
        • forEach 遍歷資料
      </text>
      <text x="250" y="761" font-size="10" text-anchor="middle" fill="#fa8c16">
        • 生成卡片 HTML
      </text>
      <text x="250" y="779" font-size="10" text-anchor="middle" fill="#fa8c16">
        • 插入 DOM
      </text>

      <!-- 連接線：成功回調 → renderCards (流動) -->
      <line
        x1="250"
        y1="630"
        x2="250"
        y2="680"
        stroke="#52c41a"
        stroke-width="2.5"
        marker-end="url(#arrowgreen)"
        class="flow-green"
      />
      <text x="265" y="660" font-size="10" fill="#52c41a">allData</text>

      <!-- 第五層：setupFilterButtons 函式 -->
      <rect
        x="430"
        y="680"
        width="240"
        height="110"
        rx="8"
        fill="#f9f0ff"
        stroke="#9254de"
        stroke-width="2"
      />
      <text
        x="550"
        y="705"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#531dab"
      >
        setupFilterButtons()
      </text>
      <text x="550" y="725" font-size="10" text-anchor="middle" fill="#9254de">
        • querySelectorAll('.filter-btn')
      </text>
      <text x="550" y="743" font-size="10" text-anchor="middle" fill="#9254de">
        • forEach 綁定事件
      </text>
      <text x="550" y="761" font-size="10" text-anchor="middle" fill="#9254de">
        • addEventListener('click')
      </text>
      <text x="550" y="779" font-size="10" text-anchor="middle" fill="#9254de">
        • 設定篩選邏輯
      </text>

      <!-- 連接線：成功回調 → setupFilterButtons (繞過卡片，流動) -->
      <path
        d="M 340 575 L 400 575 L 400 645 L 490 645 L 490 680"
        fill="none"
        stroke="#52c41a"
        stroke-width="2.5"
        marker-end="url(#arrowgreen)"
        class="flow-green"
      />

      <!-- 第六層：DOM 元素 -->
      <rect
        x="80"
        y="850"
        width="160"
        height="80"
        rx="8"
        fill="#fafafa"
        stroke="#d9d9d9"
        stroke-width="2"
      />
      <text
        x="160"
        y="875"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#595959"
      >
        DOM: #app
      </text>
      <text x="160" y="895" font-size="10" text-anchor="middle" fill="#8c8c8c">
        顯示商品卡片
      </text>
      <text x="160" y="913" font-size="10" text-anchor="middle" fill="#8c8c8c">
        grid 網格布局
      </text>

      <!-- 連接線：renderCards → DOM (繞過卡片，流動) -->
      <path
        d="M 180 790 L 160 810 L 160 850"
        fill="none"
        stroke="#fa8c16"
        stroke-width="2.5"
        marker-end="url(#arroworange)"
        class="flow-orange"
      />
      <text x="115" y="825" font-size="10" fill="#fa8c16">innerHTML</text>

      <!-- 第六層：篩選按鈕 DOM -->
      <rect
        x="280"
        y="850"
        width="180"
        height="80"
        rx="8"
        fill="#fafafa"
        stroke="#d9d9d9"
        stroke-width="2"
      />
      <text
        x="370"
        y="875"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#595959"
      >
        DOM: .filter-btn
      </text>
      <text x="370" y="895" font-size="10" text-anchor="middle" fill="#8c8c8c">
        全部/低/中/高
      </text>
      <text x="370" y="913" font-size="10" text-anchor="middle" fill="#8c8c8c">
        價格篩選按鈕
      </text>

      <!-- 連接線：setupFilterButtons → 篩選按鈕 (繞過卡片，流動) -->
      <path
        d="M 530 790 L 480 810 L 420 810 L 370 810 L 370 850"
        fill="none"
        stroke="#9254de"
        stroke-width="2.5"
        marker-end="url(#arrowpurple)"
        class="flow-purple"
      />
      <text x="410" y="805" font-size="10" fill="#9254de">事件綁定</text>

      <!-- 第七層：filterAndRender 函式 -->
      <rect
        x="730"
        y="850"
        width="240"
        height="110"
        rx="8"
        fill="#e6fffb"
        stroke="#13c2c2"
        stroke-width="2"
      />
      <text
        x="850"
        y="875"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#006d75"
      >
        filterAndRender()
      </text>
      <text x="850" y="895" font-size="10" text-anchor="middle" fill="#13c2c2">
        • 讀取 currentFilter
      </text>
      <text x="850" y="913" font-size="10" text-anchor="middle" fill="#13c2c2">
        • allData.filter(價格)
      </text>
      <text x="850" y="931" font-size="10" text-anchor="middle" fill="#13c2c2">
        • 呼叫 renderCards()
      </text>
      <text x="850" y="949" font-size="10" text-anchor="middle" fill="#13c2c2">
        • 重新渲染畫面
      </text>

      <!-- 連接線：按鈕點擊 → filterAndRender (繞過卡片，流動) -->
      <path
        d="M 460 890 L 540 890 L 600 890 L 730 890"
        fill="none"
        stroke="#9254de"
        stroke-width="2.5"
        marker-end="url(#arrowpurple)"
        class="flow-purple"
      />
      <text x="580" y="880" font-size="10" fill="#9254de">click 事件</text>

      <!-- 連接線：filterAndRender → renderCards (繞過卡片，流動，虛線) -->
      <path
        d="M 730 930 L 50 930 L 50 735 L 130 735"
        fill="none"
        stroke="#52c41a"
        stroke-width="2.5"
        stroke-dasharray="8,4"
        marker-end="url(#arrowgreen)"
        class="flow-green"
      />
      <text x="320" y="945" font-size="10" fill="#52c41a">
        filteredData 回流
      </text>

      <!-- 第八層：全域變數區 -->
      <rect
        x="730"
        y="680"
        width="240"
        height="110"
        rx="8"
        fill="#fffbe6"
        stroke="#fadb14"
        stroke-width="2"
      />
      <text
        x="850"
        y="705"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#ad8b00"
      >
        全域變數
      </text>
      <text x="850" y="725" font-size="10" text-anchor="middle" fill="#d4b106">
        CSV_URL: 字串
      </text>
      <text x="850" y="743" font-size="10" text-anchor="middle" fill="#d4b106">
        allData: 陣列
      </text>
      <text x="850" y="761" font-size="10" text-anchor="middle" fill="#d4b106">
        currentFilter: 字串
      </text>
      <text x="850" y="779" font-size="10" text-anchor="middle" fill="#d4b106">
        app: DOM 元素
      </text>

      <!-- 連接線：全域變數的使用 (靜態虛線) -->
      <line
        x1="730"
        y1="735"
        x2="670"
        y2="735"
        stroke="#fadb14"
        stroke-width="1.5"
        stroke-dasharray="3,3"
      />
      <path
        d="M 850 790 L 850 820 L 900 820 L 900 850"
        fill="none"
        stroke="#fadb14"
        stroke-width="1.5"
        stroke-dasharray="3,3"
      />

      <!-- 第九層：資料結構說明 -->
      <rect
        x="80"
        y="1000"
        width="480"
        height="160"
        rx="8"
        fill="#f0f0f0"
        stroke="#8c8c8c"
        stroke-width="2"
      />
      <text
        x="320"
        y="1025"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#262626"
      >
        資料結構流程
      </text>

      <text x="95" y="1050" font-size="11" fill="#595959">
        1. CSV 原始資料 (Google Sheets)
      </text>
      <text x="110" y="1068" font-size="10" fill="#8c8c8c">
        ↓ Papa.parse 解析
      </text>

      <text x="95" y="1088" font-size="11" fill="#595959">
        2. JSON 物件陣列 (allData)
      </text>
      <text x="110" y="1106" font-size="10" fill="#8c8c8c">
        { name, price, tags, image_url }
      </text>

      <text x="95" y="1126" font-size="11" fill="#595959">
        3. 篩選後資料 (filteredData)
      </text>
      <text x="110" y="1144" font-size="10" fill="#8c8c8c">
        ↓ 根據價格範圍過濾
      </text>

      <!-- 第九層：事件流程說明 -->
      <rect
        x="620"
        y="1000"
        width="500"
        height="160"
        rx="8"
        fill="#f0f0f0"
        stroke="#8c8c8c"
        stroke-width="2"
      />
      <text
        x="870"
        y="1025"
        font-size="13"
        font-weight="bold"
        text-anchor="middle"
        fill="#262626"
      >
        事件處理流程
      </text>

      <text x="635" y="1050" font-size="11" fill="#595959">
        1. 用戶點擊篩選按鈕 (click event)
      </text>
      <text x="650" y="1068" font-size="10" fill="#8c8c8c">↓</text>

      <text x="635" y="1088" font-size="11" fill="#595959">
        2. 更新 active 樣式 + currentFilter 變數
      </text>
      <text x="650" y="1106" font-size="10" fill="#8c8c8c">↓</text>

      <text x="635" y="1126" font-size="11" fill="#595959">
        3. filterAndRender() 執行篩選邏輯
      </text>
      <text x="650" y="1144" font-size="10" fill="#8c8c8c">
        ↓ 呼叫 renderCards(filteredData)
      </text>

      <!-- 第十層：關鍵技術說明 -->
      <rect
        x="80"
        y="1220"
        width="1040"
        height="140"
        rx="8"
        fill="#fff"
        stroke="#1890ff"
        stroke-width="2"
      />
      <text
        x="600"
        y="1245"
        font-size="14"
        font-weight="bold"
        text-anchor="middle"
        fill="#0050b3"
      >
        關鍵技術與資料流總結
      </text>

      <g transform="translate(100, 1260)">
        <circle cx="0" cy="0" r="4" fill="#52c41a" />
        <text x="10" y="5" font-size="11" fill="#595959">
          Papa.parse() 異步下載與解析 CSV
        </text>
      </g>

      <g transform="translate(100, 1285)">
        <circle cx="0" cy="0" r="4" fill="#fa8c16" />
        <text x="10" y="5" font-size="11" fill="#595959">
          innerHTML 動態生成 DOM 卡片
        </text>
      </g>

      <g transform="translate(100, 1310)">
        <circle cx="0" cy="0" r="4" fill="#9254de" />
        <text x="10" y="5" font-size="11" fill="#595959">
          addEventListener 事件委派與篩選邏輯
        </text>
      </g>

      <g transform="translate(100, 1335)">
        <circle cx="0" cy="0" r="4" fill="#13c2c2" />
        <text x="10" y="5" font-size="11" fill="#595959">
          Array.filter() 即時過濾商品資料
        </text>
      </g>

      <g transform="translate(520, 1260)">
        <circle cx="0" cy="0" r="4" fill="#fadb14" />
        <text x="10" y="5" font-size="11" fill="#595959">
          全域變數管理應用狀態
        </text>
      </g>

      <g transform="translate(520, 1285)">
        <circle cx="0" cy="0" r="4" fill="#ff4d4f" />
        <text x="10" y="5" font-size="11" fill="#595959">
          錯誤處理與用戶提示
        </text>
      </g>

      <g transform="translate(520, 1310)">
        <circle cx="0" cy="0" r="4" fill="#597ef7" />
        <text x="10" y="5" font-size="11" fill="#595959">
          回調函式 (callback) 處理異步結果
        </text>
      </g>

      <g transform="translate(520, 1335)">
        <circle cx="0" cy="0" r="4" fill="#d46b08" />
        <text x="10" y="5" font-size="11" fill="#595959">
          模板字串生成 HTML 結構
        </text>
      </g>
    </svg>
  </body>
</html>
